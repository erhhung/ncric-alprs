# global options
Host *
  # the "ServerAlive*" settings prevent an SSH
  # session from idle disconnection, but could
  # be a security risk
  ServerAliveInterval 30
  ServerAliveCountMax 2
  TCPKeepAlive yes
  ForwardAgent yes
  IdentitiesOnly yes
  GSSAPIAuthentication no
  IgnoreUnknown UseKeychain
  UseKeychain yes

# defined first because SSH only uses the
# first value specified for each property
Host alprs*sftp
  User sftp_test
  IdentityFile ~/.ssh/sftp
  ProxyCommand nc $([ $http_proxy ] && sed -En 's|.+//([^:]+).*|-x \1|p' <<< $http_proxy) %h %p

Host alprsdevsftp
  HostName sftp.dev.astrometrics.us
Host alprsprodsftp
  HostName sftp.astrometrics.us

# expects AWS profiles with already
# established IAM admin credentials;
# make sure to use recent AWS CLI v2
Host alprsdev*
  ProxyCommand aws --profile alprscom --region us-west-2 ssm start-session --target %h --document-name AWS-StartSSHSession --parameters "portNumber=%p"
Host alprsprod*
  ProxyCommand aws --profile alprsgov --region us-gov-west-1 ssm start-session --target %h --document-name AWS-StartSSHSession --parameters "portNumber=%p"

# the instance IDs of the following hosts can be updated by the
# "upssh.sh" script when run after those instances get recreated
Host alprsdevpg*
  HostName i-0af11cee35be3b40b
Host alprsdeves*
  HostName i-0863173ea096fda34
Host alprsdevcond*
  HostName i-005499a2b39a34dda
Host alprsdevdata*
  HostName i-09b178d5f410ff9dc
Host alprsdevidx*
  HostName i-01ab44fce72b64894
Host alprsdevbast*
  HostName i-0ca3a779702d187f1
Host alprsdevwork*
  HostName i-062599caf04193f3b

Host alprsprodpg*
  HostName i-0d5b04d02ae364f18
Host alprsprodes*
  HostName i-093d921a52278ae5e
Host alprsprodcond*
  HostName i-076aecbb7ba4c207f
Host alprsproddata*
  HostName i-0827538d97bd410a8
Host alprsprodidx*
  HostName i-092f89392e2164a0c
Host alprsprodbast*
  HostName i-034459244121fa8ed
Host alprsprodwork*
  HostName i-0e43df93c7f0c8062

Host alprs*bast*
  User ec2-user
Host alprs*
  User ubuntu
  StrictHostKeyChecking = no

# use private keys that match public
# keys defined in "config/*.tfvars"
Host alprsdev*
  IdentityFile ~/.ssh/alprscom
Host alprsprod*
  IdentityFile ~/.ssh/alprsgov

Host alprs*tun
  ExitOnForwardFailure yes
  RemoteCommand none
  RequestTTY no

Host alprs*pgtun
  LocalForward 5433 localhost:5432
Host alprs*estun
  # Elasticsearch REST and Kibana
  LocalForward 9201 localhost:9200
  LocalForward 9202 localhost:443
Host alprs*basttun
  # Rundeck UI and lattice-org app
  LocalForward 4440 localhost:4440
  LocalForward 9001 localhost:9000
