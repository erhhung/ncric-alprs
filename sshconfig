# global options
Host *
  TCPKeepAlive yes
  ForwardAgent yes
  IdentitiesOnly yes
  IgnoreUnknown UseKeychain
  UseKeychain yes

# defined first because SSH only uses the
# first value specified for each property
Host alprs*sftp
  User sftp_test
  IdentityFile ~/.ssh/sftp
  ProxyCommand nc $([ $http_proxy ] && sed -En 's|.+//([^:]+).*|-x \1|p' <<< $http_proxy) %h %p

Host alprsdevsftp
  HostName sftp.dev.astrometrics.us
Host alprsprodsftp
  HostName sftp.astrometrics.us

# expects AWS profiles with already
# established IAM admin credentials;
# make sure to use recent AWS CLI v2
Host alprsdev*
  ProxyCommand aws --profile alprscom --region us-west-2 ssm start-session --target %h --document-name AWS-StartSSHSession --parameters "portNumber=%p"
Host alprsprod*
  ProxyCommand aws --profile alprsgov --region us-gov-west-1 ssm start-session --target %h --document-name AWS-StartSSHSession --parameters "portNumber=%p"

# the instance IDs of the following hosts can be updated by the
# "upssh.sh" script when run after those instances get recreated
Host alprsdevbast*
  HostName i-0123456789abcdef0
Host alprsdevpg*
  HostName i-0123456789abcdef0
Host alprsdeves*
  HostName i-0123456789abcdef0
Host alprsdevcond*
  HostName i-0123456789abcdef0
Host alprsdevdata*
  HostName i-0123456789abcdef0
Host alprsdevidx*
  HostName i-0123456789abcdef0
Host alprsdevwork*
  HostName i-0123456789abcdef0

Host alprsprodbast*
  HostName i-0123456789abcdef0
Host alprsprodpg*
  HostName i-0123456789abcdef0
Host alprsprodes*
  HostName i-0123456789abcdef0
Host alprsprodcond*
  HostName i-0123456789abcdef0
Host alprsproddata*
  HostName i-0123456789abcdef0
Host alprsprodidx*
  HostName i-0123456789abcdef0
Host alprsprodwork*
  HostName i-0123456789abcdef0

Host alprs*bast*
  User ec2-user
Host alprs*
  User ubuntu
  StrictHostKeyChecking = no

# use private keys that match public
# keys defined in "config/*.tfvars"
Host alprsdev*
  IdentityFile ~/.ssh/alprscom
Host alprsprod*
  IdentityFile ~/.ssh/alprsgov

Host alprs*tun
  ExitOnForwardFailure yes
  RemoteCommand none
  RequestTTY no

Host alprs*basttun
  # Rundeck UI and lattice-org app
  LocalForward 4440 localhost:4440
  LocalForward 9001 localhost:9000
  LocalForward 5433 postgresql:5432
  LocalForward 9201 elasticsearch:9200
  LocalForward 9202 elasticsearch:443
Host alprs*pgtun
  LocalForward 5433 localhost:5432
Host alprs*estun
  # Elasticsearch REST and Kibana
  LocalForward 9201 localhost:9200
  LocalForward 9202 localhost:443
