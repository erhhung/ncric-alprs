# global options
Host *
  TCPKeepAlive yes
  ForwardAgent yes
  IdentitiesOnly yes
  IgnoreUnknown UseKeychain
  UseKeychain yes

# defined first because SSH only uses the
# first value specified for each property
Host alprs*sftp
  User sftp_test
  IdentityFile ~/.ssh/sftp
  ProxyCommand nc $([ $http_proxy ] && sed -En 's|.+//([^:]+).*|-x \1|p' <<< $http_proxy) %h %p

Host alprsdevsftp
  HostName sftp.dev.astrometrics.us
Host alprsprodsftp
  HostName sftp.astrometrics.us

# expects AWS profiles with already
# established IAM admin credentials;
# make sure to use recent AWS CLI v2
Host alprsdev*
  ProxyCommand aws --profile alprscom --region us-west-2 ssm start-session --target %h --document-name AWS-StartSSHSession --parameters "portNumber=%p"
Host alprsprod*
  ProxyCommand aws --profile alprsgov --region us-gov-west-1 ssm start-session --target %h --document-name AWS-StartSSHSession --parameters "portNumber=%p"

# the instance IDs of the following hosts can be updated by the
# "upssh.sh" script when run after those instances get recreated
Host alprsdevbast*
  HostName i-084dd77c1674ee09e
Host alprsdevpg*
  HostName i-0a353f0fb0f12edca
Host alprsdeves*
  HostName i-01184590d159a271e
Host alprsdevcond*
  HostName i-07bc8bdcdc5b15279
Host alprsdevdata*
  HostName i-0d75da862fbb86d54
Host alprsdevidx*
  HostName i-02e8eafab18e018ee

Host alprs*bast*
  User ec2-user
Host alprs*
  User ubuntu
  StrictHostKeyChecking = no

# use private keys that match public
# keys defined in "config/*.tfvars"
Host alprsdev*
  IdentityFile ~/.ssh/alprscom
Host alprsprod*
  IdentityFile ~/.ssh/alprsgov

Host alprs*tun
  ExitOnForwardFailure yes
  RemoteCommand none
  RequestTTY no

Host alprs*basttun
  # lattice-org app
  LocalForward 9001 localhost:9000
Host alprs*pgtun
  LocalForward 5433 localhost:5432
Host alprs*estun
  # Elasticsearch REST and Kibana
  LocalForward 9201 localhost:9200
  LocalForward 9202 localhost:443
